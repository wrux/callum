---
import SanityPicture from 'astro-sanity-picture';
import { imageBuilder } from '~/sanity/image';

const { images } = Astro.props.node;
---

<section
  class="relative"
  x-data="{
    showOverlay: false,
    get track() {
      return this.$refs?.imageGalleryTrack;
    },
    init() {
      if (!this.track) return;
      this.showOverlay = this.track.scrollLeft === 0;
      this?.track.addEventListener(
        'scroll',
        () => this.showOverlay = this.track.scrollLeft === 0,
        { passive: true }
      );
    },
  }"
>
  <div
    class="wrapper my-8 md:my-12 lg:my-16"
    x-ref="imageGalleryTrack"
  >
    <div class="relative container max-w-full lg:max-w-screen-xl">
      <div class="flex gap-4 lg:gap-8 items-center">
        {
          images.map(({ caption, image }, index) => (
            <div class="item rounded-xl overflow-hidden shadow-lg border border-gray-800">
              <SanityPicture
                src={image}
                imageUrlBuilder={imageBuilder}
                style={{
                  width: '100%',
                  height: 'auto',
                }}
                sizes="(max-width: 896px) calc(75vw - 3rem) , 768px"
                loading="lazy"
                img={{
                  alt: image.asset.alt || caption || '',
                }}
              />
            </div>
          ))
        }
      </div>
    </div>
  </div>

  <div
    class="absolute top-1/2 z-10 w-full pointer-events-none transition-all duration-500 -translate-y-1/2"
    x-cloak
    :class="showOverlay ? 'translate-x-0' : 'opacity-0 -translate-x-8'"
  >
    <div class="container max-w-full lg:max-w-screen-xl">
      <p
        class="inline-block py-2 px-4 bg-gray-800/80 rounded-full ml-4"
      >
        <span class="type-text-sm">
          Scroll for more

          <svg
            class="inline-block h-[1.3em] w-[1.3em] translate-y-[-5%]"
            xmlns="http://www.w3.org/2000/svg"
            fill="currentColor"
            viewBox="0 0 256 256"
            aria-label="Right arrow"
          >
            <path
              d="M221.66,133.66l-72,72a8,8,0,0,1-11.32-11.32L196.69,136H40a8,8,0,0,1,0-16H196.69L138.34,61.66a8,8,0,0,1,11.32-11.32l72,72A8,8,0,0,1,221.66,133.66Z"
            ></path>
          </svg>
        </span>
      </p>
    </div>
  </div>
</section>

<style scoped>
  .wrapper {
    overflow-x: auto;
    scroll-snap-type: x mandatory;
  }

  .item {
    flex: 1 0 auto;
    width: min(calc(100vw - 8rem), 48rem);
  }
</style>
