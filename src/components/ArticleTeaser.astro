---
import SanityPicture from 'astro-sanity-picture';
import { imageBuilder } from '~/sanity/image';

export type Props = ArticleTeaser & {
  lazy?: boolean | number;
  sizes?: string;
};

const {
  excerpt,
  imageCount,
  lazy = false,
  mainImage,
  readingTime,
  sizes = '(max-width: 767px) calc(100vw - 2rem), (max-width: 1023px) calc((100vw - 3rem) * 0.5), (max-width: 1535px) calc((100vw - 4rem) * 0.33), 28rem',
  slug,
  title,
} = Astro.props;
---

<article
  class="flex flex-col link-box group bg-gray-900 rounded-2xl overflow-hidden shadow-md hover:shadow-2xl transition-all duration-500 border border-gray-800/50 hover:border-gray-700"
>
  {
    mainImage && (
      <figure class="w-full overflow-hidden relative">
        <div class="relative aspect-[16/9] overflow-hidden">
          <SanityPicture
            src={mainImage}
            imageUrlBuilder={imageBuilder}
            sizes={sizes}
            loading={lazy ? 'lazy' : 'eager'}
            img={{
              alt: mainImage.asset.alt || title || '',
              class: 'transition-transform duration-700 ease-out group-hover:scale-110 w-full h-full object-cover',
            }}
          />
          <div class="absolute inset-0 bg-gradient-to-t from-black/40 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
        </div>
      </figure>
    )
  }
  <div class="p-4 md:p-5 lg:p-6 flex flex-col flex-grow">
    {
      (imageCount || readingTime) && (
        <p class="type-text-xs type-text-muted mb-2 uppercase tracking-wider font-medium">
          {[
            readingTime && `${readingTime} min read`,
            imageCount && `${imageCount} image${imageCount > 1 ? 's' : ''}`,
          ]
            .filter(Boolean)
            .join(' â€¢ ')}
        </p>
      )
    }
    <h2 class="type-h3 mb-2 group-hover:text-brand-light transition-colors duration-300 text-left">
      {title}
    </h2>
    {excerpt && (
      <p class="type-text-sm mb-3 line-clamp-2 text-gray-400 text-left leading-relaxed flex-grow">
        {excerpt}
      </p>
    )}
    <div class="mt-auto">
      <a
        class="link link-overlay font-medium inline-flex items-baseline gap-1.5 group/link text-brand-light hover:text-brand-medium transition-colors duration-200 text-sm"
        href={`/article/${slug}`}
        title={`Read full article: ${title}`}
        aria-label={`Read full article: ${title}`}
      >
        <span>Read article</span>
        <svg
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
          stroke-width="2.5"
          class="w-3.5 h-3.5 transition-transform duration-200 group-hover/link:translate-x-1 inline-block"
          aria-hidden="true"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M9 5l7 7-7 7"
          />
        </svg>
      </a>
    </div>
  </div>
</article>
